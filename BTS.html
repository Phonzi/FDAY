<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTS Matching Game</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f3e8ff; /* Light lavender background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }

        .game-container {
            max-width: 95vw;
            width: 100%;
        }

        /* Set perspective on the parent of the flipping element */
        .card-container {
            perspective: 1000px;
            aspect-ratio: 1 / 1; /* More direct way to set aspect ratio */
        }
        
        /* Card flip animation */
        .card {
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
            width: 100%;
            height: 100%;
            position: relative;
        }

        .card.is-flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden; /* Safari */
            border-radius: 0.75rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .card-face-front {
            background-color: #2d3748; 
            background-image: linear-gradient(45deg, #4c51bf, #6b46c1); /* Purple gradient */
        }
        
        .card-face-front:hover {
            opacity: 0.9;
        }

        .card-face-back {
            transform: rotateY(180deg);
            overflow: hidden; /* Ensures image corners are rounded */
            background-color: white; /* Add a background color for loading */
        }
        
        .card-face-back img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .card.matched {
            pointer-events: none; /* Make matched cards unclickable */
        }

        /* Simplified matched styles */
        .card.matched .card-face-front,
        .card.matched .card-face-back {
            background: white;
            opacity: 0.6;
        }
        .card.matched .card-face-back img {
            opacity: 0.5;
        }


        /* Star animation */
        .star {
            position: fixed; /* Position relative to viewport */
            font-size: 2rem;
            color: #FFD700; /* Gold */
            pointer-events: none;
            z-index: 100;
        }
    </style>
</head>
<body class="bg-purple-100">

    <div id="game-container" class="game-container flex flex-col items-center p-4">
        
        <!-- Instructions Modal -->
        <div id="instructions-modal" class="bg-white p-8 rounded-2xl shadow-2xl text-center max-w-md mx-auto">
            <h1 class="text-3xl font-bold text-purple-700 mb-2">BTS Photo Match!</h1>
            <p class="text-gray-600 mb-6">You went to their concert and almost derailed their limo... but can you tell them apart? Match the pictures of the BTS members. Click a square to reveal a photo. Find all the pairs to win!</p>
            <button id="start-button" class="bg-purple-600 text-white font-bold py-3 px-8 rounded-full hover:bg-purple-700 transition-all transform hover:scale-105 shadow-lg">Start Game</button>
        </div>

        <!-- Game Board (initially hidden) -->
        <div id="game-board" class="hidden w-full max-w-xs sm:max-w-sm md:max-w-md grid grid-cols-2 gap-3 md:gap-4">
            <!-- Cards will be generated by JavaScript -->
        </div>

        <!-- Win Modal (initially hidden) -->
        <div id="win-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center p-4 z-50">
            <div class="bg-white p-8 rounded-2xl shadow-2xl text-center transform scale-95 transition-transform duration-300">
                <h2 class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-500 to-pink-500 mb-4">BTS Superfan!</h2>
                <p class="text-2xl text-gray-700 mb-6">Right this way 아미!</p>
                <a href="./Mac.html" id="continue-button" class="inline-block bg-gradient-to-r from-yellow-400 to-orange-500 text-white font-bold py-3 px-10 rounded-full hover:from-yellow-500 hover:to-orange-600 transition-all transform hover:scale-105 shadow-xl">
                    Continue
                </a>
            </div>
        </div>

    </div>

    <script>
        // Wrap everything in a DOMContentLoaded listener to ensure the page is ready
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- DOM Elements ---
            const gameBoard = document.getElementById('game-board');
            const instructionsModal = document.getElementById('instructions-modal');
            const startButton = document.getElementById('start-button');
            const winModal = document.getElementById('win-modal');
            
            // --- Game State ---
            let hasFlippedCard = false;
            let lockBoard = false;
            let firstCard, secondCard;
            let matchedPairs = 0;

            // --- Image Data ---
            const btsImageUrls = [
                'https://ibighit.com/bts/images/profile/proof/member/member-rm.jpg',
                'https://ibighit.com/bts/images/profile/proof/member/member-jin.jpg',
                'https://ibighit.com/bts/images/profile/proof/member/member-suga.jpg',
                'https://ibighit.com/bts/images/profile/proof/member/member-jhope.jpg',
                'https://ibighit.com/bts/images/profile/proof/member/member-jimin.jpg',
                'https://ibighit.com/bts/images/profile/proof/member/member-v.jpg',
                'https://ibighit.com/bts/images/profile/proof/member/member-jk.jpg'
            ];

            // --- Functions ---
            function shuffle(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }
            
            function createBoard() {
                // Clear the board first
                gameBoard.innerHTML = '';
                matchedPairs = 0;
                
                const gameImages = shuffle([...btsImageUrls, ...btsImageUrls]);

                // Use a document fragment for performance
                const fragment = document.createDocumentFragment();

                gameImages.forEach(imageUrl => {
                    const cardContainer = document.createElement('div');
                    cardContainer.className = 'card-container'; 

                    const card = document.createElement('div');
                    card.className = 'card';
                    card.dataset.name = imageUrl; 

                    card.innerHTML = `
                        <div class="card-face card-face-front"></div>
                        <div class="card-face card-face-back">
                            <img src="${imageUrl}" alt="BTS Member" class="pointer-events-none" onerror="this.onerror=null;this.src='https.placehold.co/200x200/cccccc/ffffff?text=Error';">
                        </div>
                    `;
                    
                    card.addEventListener('click', flipCard);
                    cardContainer.appendChild(card);
                    fragment.appendChild(cardContainer);
                });

                gameBoard.appendChild(fragment);
            }

            function flipCard() {
                if (lockBoard || this.classList.contains('is-flipped')) return;
                
                this.classList.add('is-flipped');

                if (!hasFlippedCard) {
                    hasFlippedCard = true;
                    firstCard = this;
                    return;
                }

                secondCard = this;
                lockBoard = true; 
                checkForMatch();
            }

            function checkForMatch() {
                const isMatch = firstCard.dataset.name === secondCard.dataset.name;
                isMatch ? disableCards() : unflipCards();
            }

            function disableCards() {
                firstCard.classList.add('matched');
                secondCard.classList.add('matched');
                
                createStarExplosion(firstCard);
                createStarExplosion(secondCard);
                
                matchedPairs++;
                if (matchedPairs === btsImageUrls.length) {
                   setTimeout(showWinModal, 800);
                }

                resetBoard();
            }

            function createStarExplosion(element) {
                const rect = element.getBoundingClientRect();
                for(let i = 0; i < 10; i++) {
                    const star = document.createElement('div');
                    star.innerHTML = '&#9733;';
                    star.className = 'star';
                    
                    const starX = rect.left + (rect.width / 2);
                    const starY = rect.top + (rect.height / 2);

                    star.style.left = `${starX}px`;
                    star.style.top = `${starY}px`;
                    
                    const randomX = (Math.random() - 0.5) * 150;
                    const randomY = (Math.random() - 0.5) * 150;

                    document.body.appendChild(star);
                    
                    star.animate([
                        { transform: 'scale(0)', opacity: 1 },
                        { transform: `translate(${randomX}px, ${randomY}px) scale(1.5)`, opacity: 0.8 },
                        { transform: `translate(${randomX * 1.5}px, ${randomY * 1.5}px) scale(0)`, opacity: 0 }
                    ], { duration: 1500, easing: 'ease-out' });

                    setTimeout(() => star.remove(), 1500);
                }
            }

            function unflipCards() {
                setTimeout(() => {
                    firstCard.classList.remove('is-flipped');
                    secondCard.classList.remove('is-flipped');
                    resetBoard();
                }, 1200);
            }
            
            function resetBoard() {
                [hasFlippedCard, lockBoard] = [false, false];
                [firstCard, secondCard] = [null, null];
            }

            function showWinModal() {
                winModal.classList.remove('hidden');
                setTimeout(() => {
                     winModal.querySelector('div').style.transform = 'scale(1)';
                }, 10); 
            }

            function startGame() {
                instructionsModal.classList.add('hidden');
                gameBoard.classList.remove('hidden');
                createBoard();
            }

            // --- Event Listener ---
            startButton.addEventListener('click', startGame);
        });
    </script>
</body>
</html>
